{#
# Licensed under the GNU General Public License v. 3 (the "License")
# You may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.gnu.org/licenses/gpl-3.0.html
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Copyright (C) 2022-2024 xqyjlj<xqyjlj@126.com>
#
# @author      xqyjlj
# @file        gpio.c.j2
#
# Change Logs:
# Date           Author       Notes
# ------------   ----------   -----------------------------------------------
# 2024-03-22     xqyjlj       initial version
#
#}
{%- extends "csp-file-base.c.j2" %}

{%- block includes %}
#include "csplink/gpio.h"
{%- endblock %}

{%- block function_body %}
void csplink_gpio_init(void)
{
    GPIO_Config_T config = { 0 };
{%  set gpio_configs = CoderData["GpioConfigs"] %}
{%- set gpio_infos = gpio_configs["Infos"] %}
    /* enable the {{gpio_configs["Clock"]["Names"]|join(",")}} ports clock */
    RCM_EnableAPB2PeriphClock({{gpio_configs["Clock"]["Values"]|join(" | ")}});

{%- for gpiox in gpio_infos|sort %}
    {%- for pin in gpio_infos[gpiox]|sort %}
{%  set pin_info = gpio_infos[gpiox][pin] %}
    /**************************************************************************/
        {%- if pin_info["Comment"] %}
    /* configure the {{pin_info["Port"]}}-->{{gpiox}}, {{pin_info["Pin"]}}-->{{pin}} */
        {%- else %}
    /* configure the {{pin_info["Port"]}}, {{pin_info["Pin"]}} */
        {%- endif %}

        {%- if pin_info["Level"] %}
    GPIO_WriteBitValue({{pin_info["Port"]}}, {{pin_info["Pin"]}}, {{pin_info["Level"]}});
        {%- endif %}

    config.pin = {{pin_info["Pin"]}};
    config.mode = {{pin_info["Mode"]}};
        {%- if pin_info["Speed"] %}
    config.speed = {{pin_info["Speed"]}};
        {%- endif %}
    GPIO_Config({{pin_info["Port"]}}, &config);
    {%- endfor %}
    {%- endfor %}
}
{%- endblock %}
